<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raksha Pro Max</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background-color: #0a0a0a; color: white; margin: 0; padding: 15px; user-select: none; overflow: hidden; }
        .btn { width: 100%; padding: 20px; margin: 10px 0; font-size: 18px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; }
        .btn-guard { background: linear-gradient(135deg, #1a237e, #3949ab); border: 2px solid #5c6bc0; }
        .btn-sos { background: #b71c1c; margin-top: 20px; }
        
        /* Predator HUD */
        #hackerHUD { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 1000; color: #0f0; font-family: monospace; padding: 20px; text-align: left; }
        .glitch { animation: glitch 0.2s infinite; color: red; font-weight: bold; }
        
        /* Fake Shutdown */
        #shutdownUI { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 2000; align-items: center; justify-content: center; flex-direction: column; }
        .spinner { border: 3px solid #222; border-top: 3px solid #555; border-radius: 50%; width: 35px; height: 35px; animation: spin 2s linear infinite; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes glitch { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div id="uiPanel">
    <h2 style="color:#3949ab">üõ°Ô∏è RAKSHA PRO MAX</h2>
    <button id="mainBtn" class="btn btn-guard" onclick="startSystem()">ACTIVATE STEALTH GUARD</button>
    <button class="btn btn-sos" onclick="triggerSOS()">MANUAL SOS</button>
    <p id="stat" style="font-size:12px; color:#555;">Status: Standby</p>
</div>

<div id="hackerHUD">
    <p>> SYSTEM_BREAK_IN: DETECTED</p>
    <p>> UPLOADING_ENCRYPTED_DATA... 88%</p>
    <p>> GPS_COORDINATES: LOCKED</p>
    <p class="glitch">>> EMERGENCY POLICE ALERT SENT <<</p>
    <div style="border:1px solid #0f0; height:150px; margin-top:20px; display:flex; align-items:center; justify-content:center;">
        [ ANALYZING TARGET ]
    </div>
</div>

<div id="shutdownUI">
    <div class="spinner"></div>
    <p style="color:#444; margin-top:15px; font-size:14px;">Shutting down...</p>
</div>

<video id="vStream" autoplay playsinline muted style="display:none;"></video>

<script>
    const TOK = "8378037937:AAGjuFdZWLnf0kFfTG_QIFCslgvrDMb-sC4";
    const CID = "8508792403";
    let active = false, fired = false, vTrack, lastX, lastY, lastZ;

    async function startSystem() {
        try {
            const s = await navigator.mediaDevices.getUserMedia({audio:true, video:{facingMode:"environment"}});
            document.getElementById("vStream").srcObject = s;
            vTrack = s.getVideoTracks()[0];
            
            // 1. Mic Trigger (Super Sensitive for Testing)
            const aCtx = new AudioContext();
            const source = aCtx.createMediaStreamSource(s);
            const proc = aCtx.createScriptProcessor(2048, 1, 1);
            const anal = aCtx.createAnalyser();
            source.connect(anal); anal.connect(proc); proc.connect(aCtx.destination);
            proc.onaudioprocess = () => {
                const d = new Uint8Array(anal.frequencyBinCount);
                anal.getByteFrequencyData(d);
                let v = d.reduce((a,b)=>a+b)/d.length;
                if(v > 20 && !fired) triggerSOS(); // Threshold 20 is very low
            };

            // 2. Shake Trigger
            window.addEventListener('devicemotion', e => {
                let acc = e.accelerationIncludingGravity;
                let d = Math.abs(lastX-acc.x) + Math.abs(lastY-acc.y) + Math.abs(lastZ-acc.z);
                if(d > 25 && !fired) triggerSOS();
                lastX=acc.x; lastY=acc.y; lastZ=acc.z;
            });

            active = true;
            document.getElementById("stat").innerText = "Status: Monitoring Sensors...";
            document.getElementById("mainBtn").innerText = "SHIELD ACTIVE";
            if(navigator.wakeLock) await navigator.wakeLock.request('screen');
        } catch(e) { alert("Enable Permissions!"); }
    }

    async function triggerSOS() {
        if(fired) return; fired = true;
        
        // Immediate Background Tasks
        sendTelemetry(); 
        setInterval(sendTelemetry, 10000); // Continuous location + battery
        startRecording();

        // 1. Predator HUD Mode
        document.getElementById("uiPanel").style.display = "none";
        document.getElementById("hackerHUD").style.display = "block";
        
        // 2. Voice & Siren Logic
        const speak = new SpeechSynthesisUtterance("Warning. Criminal activity detected. Police notified.");
        window.speechSynthesis.speak(speak);
        
        // 3. Strobe Light
        let strobe = setInterval(() => {
            if(vTrack) {
                let c = vTrack.getConstraints();
                let state = c.advanced?.[0]?.torch || false;
                vTrack.applyConstraints({advanced:[{torch: !state}]}).catch(()=>{});
            }
        }, 100);

        // 4. Final Fake Shutdown Stage (Infinite)
        setTimeout(() => {
            clearInterval(strobe);
            document.getElementById("hackerHUD").style.display = "none";
            document.getElementById("shutdownUI").style.display = "flex";
            // Start Siren in background
            startSiren();
            window.location.href = "tel:112";
        }, 7000);
    }

    async function sendTelemetry() {
        const batt = await navigator.getBattery();
        const bLevel = Math.floor(batt.level * 100) + "%";
        
        navigator.geolocation.getCurrentPosition(p => {
            const url = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
            const txt = `üö® SOS ALERT\nüìç Location: ${url}\nüîã Battery: ${bLevel}`;
            fetch(`https://api.telegram.org/bot${TOK}/sendMessage?chat_id=${CID}&text=${encodeURIComponent(txt)}`);
        }, null, {enableHighAccuracy:true});
    }

    function startRecording() {
        let rec = new MediaRecorder(document.getElementById("vStream").srcObject);
        rec.ondataavailable = (e) => {
            let fd = new FormData();
            fd.append("chat_id", CID);
            fd.append("video", e.data, "alert.mp4");
            fetch(`https://api.telegram.org/bot${TOK}/sendVideo`, {method:"POST", body:fd});
        };
        rec.start();
        setInterval(() => { if(rec.state === "recording") { rec.stop(); rec.start(); } }, 6000);
    }

    function startSiren() {
        const c = new AudioContext();
        const o = c.createOscillator();
        const g = c.createGain();
        o.type = 'sawtooth'; o.connect(g); g.connect(c.destination);
        o.start();
        setInterval(() => { o.frequency.value = o.frequency.value === 600 ? 1100 : 600; }, 400);
    }
</script>
</body>
</html>
